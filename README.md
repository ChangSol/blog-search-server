# Blog Search API SERVER

## 1. Requirements

- ë¸”ë¡œê·¸ ê²€ìƒ‰ API
  - [x] í‚¤ì›Œë“œ ê²€ìƒ‰ ê¸°ëŠ¥
  - [x] ì •ë ¬(ì •í™•ë„ìˆœ, ìµœì‹ ìˆœ) ê¸°ëŠ¥
  - [x] ResponseëŠ” Pagination í˜•íƒœ
  - [x] ë¸”ë¡œê·¸ ê²€ìƒ‰ APIëŠ” KAKAO, NAVER OPEN API í™œìš© (ê·¸ ì™¸ ì¶”ê°€ ê°€ëŠ¥)
  - [x] ë™ì‹œì„± ì œì–´ ì²˜ë¦¬ 
- ì¸ê¸° ê²€ìƒ‰ì–´ API
  - [x] ë§ì´ ê²€ìƒ‰ëœ í‚¤ì›Œë“œ TOP 10 ì œê³µ (ì…ë ¥í•˜ëŠ” í‚¤ì›Œë“œ í•„í„°ë§ ê¸°ëŠ¥ë„ ì¶”ê°€)

## 2. Environment

### 1) ê°œë°œ í™˜ê²½
- ê¸°ë³¸ ì‚¬ìš© í¬íŠ¸ : 8080
- ì½”ë“œì»¨ë²¤ì…˜ : chang_sol_code_style.xml ì°¸ê³ 
- JAVA 16
- SpringBoot 2.6.6
- JPA (Spring Data JPA)
- Hibernate 5.6.5.Final (query issue ë¡œ ì¸í•œ ë‹¤ìš´ê·¸ë ˆì´ë“œ root build.gradle ì°¸ê³ )

```
configurations.configureEach {
        resolutionStrategy.eachDependency { DependencyResolveDetails details ->
            if (details.requested.group == 'org.hibernate' && details.requested.name == 'hibernate-core') {
                details.useVersion '5.6.5.Final'
                details.because 'hibernate 5.6.7.Final query error issue. 5.6.5.Final downgrade'
            }
        }
    }
```

- H2 DB (module-core yml ì°¸ê³ )

```yaml
  h2:
    console:
      enabled: true  # H2 console ì‚¬ìš©
      path: /h2  # console ê²½ë¡œ

  #DBì„¤ì •
  datasource:
    #h2 ë“œë¼ì´ë²„ ì„¤ì •
    driver-class-name: org.h2.Driver
    #ì‚¬ìš©í•  DB URL (Connection)
    url: jdbc:h2:mem:blog_search
    username: changsol  #ID
    password: changsol^_^3  #PWD
```

- SpringDocë¥¼ í†µí•œ OpenAPI(3.0) swagger 

```yaml
#SrpingDoc ì„¤ì • API ë¬¸ì„œí™”
springdoc:
  version: 0.0.1
  api-docs:
    path: /api-docs
  #Media Type ê¸°ë³¸ ê°’ì„ application/json
  default-consumes-media-type: application/json;charset=UTF-8
  default-produces-media-type: application/json;charset=UTF-8
  cache:
    disabled: true
  swagger-ui:
    #api ë° íƒœê·¸ ì •ë ¬ ê¸°ì¤€ì„ ì•ŒíŒŒë²³ ì˜¤ë¦„ì°¨ìˆœ
    operations-sorter: alpha
    tags-sorter: alpha
    path: /swagger-ui
    #swagger-ui default urlì¸ petstore html ë¬¸ì„œ ë¹„í™œì„±í™” ì—¬ë¶€
    disable-swagger-default-url: true
    display-request-duration: true  # try it out ì„ í–ˆì„ ë•Œ request duration ì„ ì¶”ê°€ë¡œ ì°ì–´ì¤Œ
  #OpenAPI 3 ë¡œ ë¬¸ì„œí™”í•  api path ë¦¬ìŠ¤íŠ¸
  paths-to-match:
    - /v1/**
```

```java

@Component
public class SwaggerConfig {

	@Bean
	public OpenAPI openAPI(@Value("${springdoc.version}") String appVersion) {
		Info info = new Info()
			.title("Changsol Blog Search API")
			.version(appVersion)
			.description("ì°½ì†” ë¸”ë¡œê·¸ ê²€ìƒ‰ ì„œë¹„ìŠ¤ì— ì˜¤ì‹ ê±¸ í™˜ì˜í•©ë‹ˆë‹¤.ğŸ˜")
			.contact(new Contact().name("changsol-github").url("https://github.com/ChangSol"))
			.license(new License().name("Apache License Version 2.0")
								  .url("http://www.apache.org/licenses/LICENSE-2.0"));

		return new OpenAPI()
			.components(new Components())
			.info(info);
	}
}
```

### 2) ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬

- Lombok 1.18.20 (ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì²˜ë¦¬)
- MapStruct 1.5.2 (Data Mapperë¡œ ì‚¬ìš©)

### 3) ëª¨ë“ˆ êµ¬ì¡°

- module-core : ë„ë©”ì¸ ëª¨ë“ˆ
- module-external : ì™¸ë¶€ API í†µì‹  ëª¨ë“ˆ
- module-search : ë¸”ë¡œê·¸ ê²€ìƒ‰ ëª¨ë“ˆ

### 4) Domain Model

- ê²€ìƒ‰ì–´ ê´€ë¦¬ í…Œì´ë¸”
```h2
create table blog_search_keyword
(
    keyword    varchar(255)     not null, -- ê²€ìƒ‰ì–´
    created_at timestamp,                 -- ìƒì„±ì‹œê°„
    updated_at timestamp,                 -- ìˆ˜ì •ì‹œê°„
    count      bigint default 0 not null, -- ê²€ìƒ‰ íšŸìˆ˜
    version    integer,                   -- optimistic rock version
    primary key (keyword)
)
```
- ì˜¤ë¥˜ ë¡œê·¸ ê´€ë¦¬ í…Œì´ë¸”
```h2
create table error_log (
       id bigint generated by default as identity, -- ì¼ë ¨ë²ˆí˜¸
        created_at timestamp, -- ìƒì„±ì‹œê°„
        updated_at timestamp, -- ìˆ˜ì •ì‹œê°„
        data clob, -- ìš”ì²­ ë°ì´í„°
        error_class varchar(255), -- ì˜¤ë¥˜ í´ë˜ìŠ¤ëª…
        error_message clob, -- ì˜¤ë¥˜ ë©”ì‹œì§€
        method varchar(255), -- ì˜¤ë¥˜ API Method
        origin clob, -- origin url
        query clob, -- ìš”ì²­ query
        remote_addr varchar(255), -- ìš”ì²­ IP
        request_uri clob, -- ìš”ì²­ uri
        status varchar(255), -- ì˜¤ë¥˜ ìƒíƒœ
        status_code integer, -- ì˜¤ë¥˜ ìƒíƒœ ì½”ë“œ
        user_agent varchar(255), -- ìš”ì²­ ê¸°ê¸° ì •ë³´
        primary key (id)
    )
```

## 3. ì‘ë‹µ ë° ì˜¤ë¥˜

- ì½”ë“œ ì •ì˜

<table>
  <tr>
    <td>ì½”ë“œ</td>
    <td>ì„¤ëª…</td>
  </tr>
  <tr>
    <td>200</td>
    <td>ì„±ê³µ</td>
  </tr>
  <tr>
    <td>500</td>
    <td>Server Error</td>
  </tr>
  <tr>
    <td>400</td>
    <td>ì˜ëª»ëœ ìš”ì²­</td>
  </tr>
  <tr>
    <td>404</td>
    <td>ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ</td>
  </tr>
  <tr>
    <td>409</td>
    <td>ìš”ì²­ ë°ì´í„°ì— ëŒ€í•œ ì¶©ëŒ</td>
  </tr>
</table>

- ì˜¤ë¥˜ ì½”ë“œ ìƒì„¸

<table>
  <tr>
    <td>í´ë˜ìŠ¤</td>
    <td>ì½”ë“œ</td>
    <td>ì„¤ëª…</td>
    <td>ì˜ˆì‹œ</td>
  </tr>

  <tr>
    <td>ê°ì¢…í´ë˜ìŠ¤</td>
    <td>500</td>
    <td>ê°ì¢… ì˜¤ë¥˜ í´ë˜ìŠ¤ì— ëŒ€í•œ ì²˜ë¦¬</td>
    <td>

  ```json
  {
    "timestamp": "2023-03-21 14:03:50.156",
    "status": "INTERNAL_SERVER_ERROR",
    "statusCode": 500,
    "errorClass": "org.springframework.web.server.ServerErrorException",
    "errorMessage": "500 INTERNAL_SERVER_ERROR \"500 error test\"",
    "fieldErrors": []
  }
  ```

  </td>
  </tr>

  <tr>
    <td>WebClientException</td>
    <td>502</td>
    <td>WebClient í†µì‹  ì˜¤ë¥˜ 4xx ë°œìƒ ì‹œ</td>
    <td>

  ```json
  {
    "timestamp": "2023-03-21 21:25:29.238",
    "status": "BAD_GATEWAY",
    "statusCode": 502,
    "errorClass": "org.changsol.exceptions.WebClientException",
    "errorMessage": "{\"errorType\":\"AccessDeniedError\",\"message\":\"appKey(9b52e53084225d4c6983c1f4e245794f) is already deactivated\"}",
    "requestUri": "/v1/blogs",
    "fieldErrors": []
  }
  ```

  </td>
  </tr>

  <tr>
    <td>BadRequestException</td>
    <td>400</td>
    <td>ì˜ëª»ëœ ìš”ì²­</td>
    <td>

  ```json
  {
    "timestamp": "2023-03-21 21:16:46.637",
    "status": "BAD_REQUEST",
    "statusCode": 400,
    "errorClass": "org.changsol.exceptions.BadRequestException",
    "errorMessage": "ìš”ì²­í•˜ì‹  í˜ì´ì§€ì˜ ë°ì´í„°ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
    "requestUri": "/v1/blogs",
    "fieldErrors": []
  }
  ```
  </td>
  </tr>

  <tr>
    <td>BindException</td>
    <td>400</td>
    <td>ìš”ì²­ ë°ì´í„°ì— ëŒ€í•œ ìœ íš¨ì„± ê²€ì¦ ì˜¤ë¥˜</td>
    <td>

  ```json
  {
    "timestamp": "2023-03-21 04:07:25.276",
    "status": "BAD_REQUEST",
    "statusCode": 400,
    "errorClass": "org.springframework.validation.BindException",
    "errorMessage": "Binding Error",
    "fieldErrors": [
      {
        "fieldName": "keyword",
        "errorMessage": "ê²€ìƒ‰ í‚¤ì›Œë“œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤."
      },
      {
        "fieldName": "blogSortType",
        "errorMessage": "ì •ë ¬ ë°©ì‹ì€ í•„ìˆ˜ì…ë‹ˆë‹¤."
      }
    ]
  }
  ```
  </td>
  </tr>

  <tr>
    <td>NotFoundException</td>
    <td>404</td>
    <td>ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì§€ ëª»í•˜ëŠ” ì˜¤ë¥˜</td>
    <td>

  ```json
  {
    "timestamp": "2023-03-21 04:07:25.276",
    "status": "BAD_REQUEST",
    "statusCode": 400,
    "errorClass": "org.springframework.validation.BindException",
    "errorMessage": "Binding Error",
    "fieldErrors": [
      {
        "fieldName": "keyword",
        "errorMessage": "ê²€ìƒ‰ í‚¤ì›Œë“œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤."
      },
      {
        "fieldName": "blogSortType",
        "errorMessage": "ì •ë ¬ ë°©ì‹ì€ í•„ìˆ˜ì…ë‹ˆë‹¤."
      }
    ]
  }
  ```

  </td>
  </tr>
</table>

## 4. í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

## 5. ì‹¤í–‰ ë° API Docs
### 1) ì‹¤í–‰ ë°©ë²•
- Executable jar download url :
- ì‹¤í–‰ ëª…ë ¹ì–´ (ê¸°ë³¸ 8080 port)

```
java -jar blog-search-service-0.0.1-SNAPSHOT.jar
```

- ì‹¤í–‰ ëª…ë ¹ì–´ (ë‹¤ë¥¸ port ì‚¬ìš© ì‹œ)

```
java -jar "-Dserver.port=ì‚¬ìš©í• í¬íŠ¸" blog-search-service-0.0.1-SNAPSHOT.jar
```
### 2) API Document
- API Docs url : http://localhost:8080/swagger-ui

[ë³´ì—¬ì§€ëŠ” í…ìŠ¤íŠ¸](#ì´ë™í• ìœ„ì¹˜ì˜í…ìŠ¤íŠ¸)
~ìƒëµ~
#ì´ë™í• ìœ„ì¹˜ì˜í…ìŠ¤íŠ¸

### 3) H2 DB
- consol url : http://localhost:8080/h2
  ![img.png](readme_resource/img.png)
- ê³„ì • : [H2 DB ê´€ë ¨ ë‚´ìš© ì°¸ê³ ](#2-environment)
 